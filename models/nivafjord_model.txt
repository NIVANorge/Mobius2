
model("NIVAFjord") {
	
	
	air   : compartment("Atmosphere")
	basin : compartment("Basin")
	layer : compartment("Fjord layer")
	sed   : compartment("Fjord sediment")
	#bnd   : compartment("Boundary ocean")
	#bnd_layer : compartment("Boundary layer")
	
	water : quantity("Water")
	ice   : quantity("Ice")
	salt  : quantity("Salt")
	heat  : quantity("Heat energy")
	h     : quantity("Sea level")
	tracer : quantity("Tracer")
	
	evap_mm : property("Evaporation per area")
	
	temp     : property("Temperature")
	precip   : property("Precipitation")
	wind     : property("Wind speed")
	g_rad    : property("Global radiation")
	pressure : property("Pressure")
	a_hum    : property("Actual specific humidity")
	rho      : property("Density")
	lwd      : property("Downwelling longwave radiation")
	sw       : property("Shortwave radiation")
	attn     : property("Attenuation coefficient")
	
	vert    : connection("Fjord vertical", grid1d) { layer[layer_idx] }
	sw_vert : connection("Shortwave vertical", grid1d) { layer[layer_idx] }
	#bnd_vert : connection("Boundary vertical", grid1d) { bnd_layer[layer_idx] }
	
	par_group("Layer parameters", layer) {
		A      : par_real("Layer area", [m 2], 10000, 0, 1e6)
		#w_bnd  : par_real("Width to boundary", [m], 0, 0, 10000)
	}
	
	load("modules/atmospheric.txt", module("Atmospheric", air, temp, wind, g_rad, pressure, a_hum, rho, lwd))
	
	load("modules/airsea.txt",      module("AirSea", "AirSea Fjord", air, basin, ice, evap_mm, temp, precip, wind, g_rad, pressure, rho, a_hum, lwd, sw, attn,
											loc(A[vert.top]), loc(layer.water.heat[vert.top]), loc(layer.water.heat[sw_vert.top]), loc(layer.water.temp[vert.top])))
	
	load("modules/nivafjord/basin.txt",   module("NIVAFjord basin", air, basin, layer, sed, water, salt, heat, temp, precip, pressure, wind, g_rad, rho, attn, vert, sw_vert, A))
	
	#load("modules/nivafjord/tracer_test.txt", module("NIVAFjord tracer test", layer, water, tracer, vert))   # Commented out until we fix the indexing issue
	
	basin_idx : index_set("Basin index") {
		e_idx     : index_set("Edge index") #TODO: Better name?
		layer_idx : index_set("Layer index")
	}
	
	distribute(basin, basin_idx)
	distribute(layer, basin_idx, layer_idx)
	distribute(sed, basin_idx)
	#distribute(bnd_layer, layer_idx)
	
	sol : solver("Simply solver", "INCADascru", 0.1)
	
	solve(sol, layer.water, sed.heat, basin.ice)
}