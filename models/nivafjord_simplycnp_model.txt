

model("NIVAFjord-SimplyCNP") {
	
	extend("nivafjord_model.txt")
	
	extend("simplycnp_model.txt") @exclude(
		downstream : connection, 
		air : compartment, 
		water : quantity,
		heat : quantity,
		temp : property,
		precip : property,
		sol : solver
	)
	
	edge       : compartment("Basin edge")
	edge_layer : compartment("Basin edge layer")
	distribute(edge,       basin_idx, e_idx)
	distribute(edge_layer, basin_idx, e_idx, layer_idx)
	
	load("modules/nivafjord/horizontal_fluxes.txt",
		module("NIVAFjord horizontal fluxes", basin, bnd_basin, layer, bnd_layer, river, edge, edge_layer, water, salt, temp, salinity, flow, rho, pressure, dz, h, horz, vert, A, dz0))
	
	fjord_phyt : quantity("Fjord phytoplankton") # To distinguish from freshwater once we add EasyLake.
	zoo        : quantity("Zooplankton")
	o2         : quantity("O₂")
	area       : property("Area")
	
	load("modules/nivafjord/fjordchem.txt",
		chem_par : preamble("NIVAFjord chemistry rates"),
		module("NIVAFjord chemistry", air, basin, layer, sediment, water, heat, o2, ice, oc, din, on, phos, op, sed, fjord_phyt, zoo, temp, salinity, wind, z, dz, indicator, attn, precip, area, A, vert, sw_vert, chem_par))
	
	load("modules/nivafjord/sediment.txt",
		module("NIVAFjord sediments", layer, sediment, water, o2, sed, oc, din, on, phos, op, area, A, vert, chem_par))
	
	load("modules/nivafjord/boudary_chem.txt",
		module("NIVAFjord boundary chemistry", bnd_layer, water, o2, oc, sed, temp, salinity))
		
	load("modules/easychem.txt",
		module("Simple River O₂", river, water, o2, temp))
		
	#solve(fjord_sol, sediment.sed)
	solve(sol, sediment.sed)
	
	wb_index : index_set("Water body") @union(sc, basin_idx)
	
	downstream : connection("Downstream") @directed_graph {
		river+
	} @no_cycles
	
	horz : connection("Fjord horizontal") @directed_graph(e_idx) { 
		(river? layer+ bnd_layer?) | river
	} @no_cycles
}

