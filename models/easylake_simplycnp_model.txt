
model("EasyLake-SimplyCNP") {
	extend("easylake_simplyq_model.txt")
	extend("simplyc_model.txt")
	extend("simplyn_model.txt")
	extend("simplyp_model.txt")
	
	
	phyt : quantity("Phytoplankton")
	o2   : quantity("O₂")
	
	on   : quantity("Organic nitrogen")
	
	#bot  : compartment("Lake bottom sediments")
	#distribute(bot, lake_index)
	#solve(simply_solver, bot.sed)
	
	#TODO: Maybe also organic N, P later.
	# sed_area should be different for epi and hyp.
	load("modules/easychem.txt", 
		module("EasyChem", air, epi, hyp, water, oc, phyt, o2, din, phos, on, ice, sed, temp, sw, wind, indicator, tp, loc(A_surf), loc(A_surf)),
		module("EasyChem-Particulate", epi, hyp, water, sed, phos, loc(A_surf))
	)
	
	module("Simple River O₂", version(0, 1, 0)) {
		"The purpose of this module is only to provide oxygen inputs to EasyChem."
		
		#TODO: Not sure if we should do anything else for this module. Could also have mass balance and instead set concs in flow from land.
		
		load("stdlib/seawater.txt", library("Sea oxygen"))
		load("stdlib/physiochemistry.txt", library("Chemistry"))
		
		par_group("River oxygen") {
			COS_alloch : par_real("Carbon Oxidation State alloch DOC", [], -0.5, -1, 0)
		}

		var(river.water.o2, [k g], [m g, l-1], "River oxygen") @override_conc {
			o2_saturation(temp, 0) * o2_mol_mass ->>
		}
		
		var(river.water.oc.o2, [k g], [], "River DOC oxidation state") @override_conc {
			1 + COS_alloch/4
		}
		
		# Hmm: This doesn't work properly unless you also count it under PP(TDP?) and TP in the river.
		var(river.water.phyt, [k g], [m g, l-1]) # Just to allow transport of it.
		#flux(river.water.phyt, river.water.oc, [k g, day-1], "River phyto DOC release") {
		#	phyt*0.1[day-1]
		#}
		#flux(out, river.water.sed.phos, [k g, day-1], "River phyto P release") {
		#	0=>>#phyt*0.009*0.1[day-1]
		#}
		
		var(river.water.on, [k g], [m g, l-1], "River DON") #TODO: Put this into one of the modules. And make a land input of it.
	}
}