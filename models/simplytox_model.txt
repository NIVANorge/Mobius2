
model("SimplyTox") {

	# This is not a finished model, only partial

	extend("simplyc_model.txt") @exclude(sol : solver)
	extend("simplysed_model.txt") @exclude(sol : solver)
	
	par_group("Solver step") {
		solver_h     : par_real("Solver desired step", [hr], 2, 0.01, 24)
		solver_rel_h : par_real("Solver minimal relative step", [], 0.01, 1e-8, 0.1)
	}
	
	# It is in some instances necessary for the user to configure the solver step in this model.
	sol : solver("Simply solver", inca_dascru, solver_h, solver_rel_h)
	solve(sol, soil.oc, dsoil.oc, gw.oc, soilair.tox,
		river_sed.oc, river_sed.water)
	
	tox   : quantity("Contaminant")
	toc   : property("Total organic carbon")
		
	dsoil   : compartment("Slow-accessible soil")
	soilair : compartment("Soil air")
	river_sed : compartment("River sediment bed")
	
	tox_index : index_set("Contaminant type")
	
	distribute(dsoil, sc, lu)
	distribute(soilair, sc, lu)
	distribute(river_sed, sc)
	distribute(tox, tox_index)
	
	par_group("River data", river) {
		eff_a : par_real("River effective surface area", [m 2], 1000, 0, 1000000)
	}
	
	load("modules/simplyc.txt",    module("Simple river TOC", river, water, oc, sed, toc))

	load("modules/simplytox.txt",
		phys : preamble("SimplyTox physiochemical", air, tox, temp),
		module("SimplyTox soil", air, soil, dsoil, soilair, gw, water, oc, tox, temp, phys),
		module("SimplyTox partitioning", "SimplyTox soil water", soil, water, oc, tox, temp, loc(soil.oc), [m m], [n g, m-2], constant(true), phys),
		module("SimplyTox partitioning", "SimplyTox groundwater", gw, water, oc, tox, temp, loc(gw.oc), [m m], [n g, m-2], constant(false), phys),
		module("SimplyTox partitioning", "SimplyTox river water", river, water, oc, tox, temp, loc(river.water.sed.oc), [m 3], [n g], constant(true), phys),
		module("SimplyTox air-water", "SimplyTox river air-water", air, river, water, tox, temp, wind, loc(eff_a), phys),
		module("SimplyTox partitioning", "SimplyTox river bed", river_sed, water, oc, tox, temp, loc(river_sed.oc), [m m], [n g, m-2], constant(false), phys),
		module("SimplyTox river", air, soil, river, river_sed, water, oc, sed, tox, e_fact, temp, loc(eff_a), phys)
	)
	
	unit_conversion(soil.oc.tox, river.water.sed.oc.tox) { a_catch }
	
	unit_conversion(river.water.sed.oc, river_sed.oc) { 1/eff_a }
	unit_conversion(river.water, river_sed.water) { 1/eff_a }
}