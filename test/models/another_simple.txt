

model("Another simple") {

	sp : module("So simple", 1, 0, 0) {
	
		load("recursive_library.txt", library("Library A"))
		
		a : compartment("A")
		b : compartment("B")
		q : quantity("Q")
		r : quantity("R")
		
		a.has(q, unit(), "AQ") .initial { aq }
		b.has(q, unit(), "BQ") .initial { bq }
		
		a.q.has(r, unit(), "AQR")
		b.q.has(r, unit(), "BQR")
		
		a.par_group("A Pars") {
			aq : par_real("initial a q", unit(), 0)
			aqr : par_real("a q r input", unit(), 0)
		}
		
		b.par_group("B Pars") {
			bq : par_real("initial b q", unit(), 0)
		}
		
		a_out : flux(a.q, out, "a out") { 0.002*q*fun(0)	}
		b_out : flux(b.q, out, "b out") { 0.001*q   }
		
		flux(nowhere, a.q.r, "R input") { aqr }
	}
	
	sol : solver("Solver", "INCADascru", 0.1)
	sol.solve(a.q)
	sol.solve(b.q)
	sol.solve(a.q.r)
	sol.solve(b.q.r)
	
	i : index_set("A index")
	j : index_set("B index")
	
	a : compartment("A")
	b : compartment("B")
	q : quantity("Q")
	r : quantity("R")
	
	a.distribute(i)
	b.distribute(j)
	
	n : connection("graph", directed_tree) { (b|a)* }
	
	sp.a_out.to(n)
	sp.b_out.to(n)
}