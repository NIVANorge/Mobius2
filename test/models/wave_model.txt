

model("Diffusion") {
	
	module("Diffusion", 1, 0, 0) {
		
		layer : compartment("Layer")
		
		amp   : quantity("amplitude")
		mom   : quantity("momentum")
		
		layer.par_group("Layers") {
			in_amp  : par_real("Initial amplitude", unit(Pa), 0)
			in_mom  : par_real("Initial momentum", unit(Pa, day-1), 0)
			c       : par_real("Wave speed", unit(m day-1), 0.001)
		}
		
		layer.has(amp, unit(Pa)) .initial { in_amp }
		layer.has(mom, unit(Pa, day-1)) .initial { in_mom*c }
		
		l : connection("Layer connection", grid1d) { layer* }
		
		flux(layer.mom, nowhere, "Momentum propagation") {
			c * (amp - target(amp))
		}
		
		flux(layer.amp, l, "Wave propagation") {
			mom
		}
		
	}

	
	layer_index : index_set("Layer index")
	
	layer : compartment("Layer")
	
	amp   : quantity("amplitude")
	mom   : quantity("momentum")
	
	
	layer.distribute(layer_index)
	sol : solver("Solver", "INCADascru", 0.1)
	sol.solve(layer.amp)
	sol.solve(layer.mom)
}